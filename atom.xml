<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Useful Platitudes]]></title>
  <link href="http://danielmendel.github.com/atom.xml" rel="self"/>
  <link href="http://danielmendel.github.com/"/>
  <updated>2013-03-04T12:42:58-05:00</updated>
  <id>http://danielmendel.github.com/</id>
  <author>
    <name><![CDATA[Daniel Mendel]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Dumbwaiter v0.0.1]]></title>
    <link href="http://danielmendel.github.com/blog/2013/03/04/dumbwaiter-v0-dot-0-1/"/>
    <updated>2013-03-04T12:27:00-05:00</updated>
    <id>http://danielmendel.github.com/blog/2013/03/04/dumbwaiter-v0-dot-0-1</id>
    <content type="html"><![CDATA[<p>I&#8217;ve recently found myself doing a lot of experiments in HTML that are only composed of client-side code.  The trick is that to properly test them, you have to serve the pages through a host of some kind &#8211; anything that you open directly using the <code>file:</code> protocol runs into security measures that prevent the page access to certain types of assets and requests.</p>

<p>In the past I&#8217;ve either launched Chrome with <code>--allow-file-access-from-files</code> and used the <code>file:</code> protocol, or served the files through a local Apache or Nginx server.  Since I&#8217;m lazy, I decided these options were too much work and that instead I wanted a simple CLI to spin up small servers for any local directory.</p>

<p>This morning I wrote <a href="https://github.com/danielmendel/dumbwaiter"><code>dumbwaiter</code></a>, a <em>tiny</em>, 11 line <code>npm</code> module for doing just that by using the <code>connect.static</code> middleware.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="err">#</span><span class="o">!</span><span class="err">/usr/bin/env node</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">connect</span>  <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;connect&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">,</span> <span class="nx">path</span>    <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">,</span> <span class="nx">dirPath</span>  <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">)</span>
</span><span class='line'>  <span class="p">,</span> <span class="nx">PORT</span>     <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">||</span> <span class="mi">3000</span>
</span><span class='line'>  <span class="p">,</span> <span class="nx">server</span>   <span class="o">=</span> <span class="nx">connect</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="nx">server</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span> <span class="nx">connect</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span> <span class="nx">dirPath</span> <span class="p">)</span> <span class="p">)</span>
</span><span class='line'><span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span> <span class="nx">PORT</span> <span class="p">)</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;serving &#39;</span> <span class="o">+</span> <span class="nx">dirPath</span> <span class="o">+</span> <span class="s1">&#39; on port &#39;</span> <span class="o">+</span> <span class="nx">PORT</span> <span class="o">+</span> <span class="s1">&#39; ...&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Install with <code>npm install -g dumbwaiter</code>, then run as <code>dumbwaiter [rootDir] [port]</code>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[New compound animations in glitz.js]]></title>
    <link href="http://danielmendel.github.com/blog/2013/02/25/new-compound-animations-in-glitz-dot-js/"/>
    <updated>2013-02-25T17:46:00-05:00</updated>
    <id>http://danielmendel.github.com/blog/2013/02/25/new-compound-animations-in-glitz-dot-js</id>
    <content type="html"><![CDATA[<p><a href="https://github.com/danielmendel/glitz.js"><code>glitz.js</code></a> support for defining animations is pretty flexible, but it is designed for fairly simple interactive behaviors and has, until now, lacked a good method for building complex animations from component parts.  I&#8217;ve wanted to add a good API for to do this for a while and this week I finally got a chance to do so, while pairing with <a href="https://github.com/zachallaun">Zach Allaun</a> at <a href="http://www.hackerschool.com">Hacker School</a>.  I&#8217;m really excited about what we came up.  First, I&#8217;ll explain the state of affairs before our changes.</p>

<!-- more -->


<h2>Good, but not great</h2>

<p>The animation API that glitz implements is very straightforward, if you&#8217;ve ever animated <code>DOM</code> elements with <code>jQuery.animate</code> then the syntax should be pretty familiar.  All of the following animations are equivalent.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// transform ( duration defaults to 250ms )</span>
</span><span class='line'><span class="nx">box</span><span class="p">.</span><span class="nx">animate</span><span class="p">({</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">100</span> <span class="p">});</span>
</span><span class='line'><span class="c1">// transform, duration</span>
</span><span class='line'><span class="nx">box</span><span class="p">.</span><span class="nx">animate</span><span class="p">({</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">100</span> <span class="p">},</span> <span class="mi">5000</span> <span class="p">);</span>
</span><span class='line'><span class="c1">// transform, callback</span>
</span><span class='line'><span class="nx">box</span><span class="p">.</span><span class="nx">animate</span><span class="p">({</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">100</span> <span class="p">},</span> <span class="kd">function</span><span class="p">(){</span> <span class="p">...</span> <span class="p">});</span>
</span><span class='line'><span class="c1">// transform, duration, callback</span>
</span><span class='line'><span class="nx">box</span><span class="p">.</span><span class="nx">animate</span><span class="p">({</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">100</span> <span class="p">},</span> <span class="mi">5000</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span> <span class="p">...</span> <span class="p">});</span>
</span><span class='line'><span class="c1">// transform, options</span>
</span><span class='line'><span class="nx">box</span><span class="p">.</span><span class="nx">animate</span><span class="p">({</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">100</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">duration</span><span class="o">:</span> <span class="mi">5000</span><span class="p">,</span> <span class="nx">done</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span> <span class="p">...</span> <span class="p">}});</span>
</span></code></pre></td></tr></table></div></figure>


<p>If <code>animate</code> is invoked on an object while that object is still performing a previous animation, the current animation is immediately canceled and the new one begins.  This is the default behavior because interactivity requires an immediate response from objects.  If you want to build a complex series of animations, you can do so using nested callbacks.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// move left, then down, then fade the color</span>
</span><span class='line'><span class="nx">box</span><span class="p">.</span><span class="nx">animate</span><span class="p">({</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">100</span> <span class="p">},</span> <span class="mi">5000</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="nx">box</span><span class="p">.</span><span class="nx">animate</span><span class="p">({</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">100</span> <span class="p">},</span> <span class="mi">5000</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>        <span class="nx">box</span><span class="p">.</span><span class="nx">animate</span><span class="p">({</span> <span class="nx">strokeColor</span><span class="o">:</span> <span class="s1">&#39;#f00&#39;</span> <span class="p">},</span> <span class="mi">5000</span> <span class="p">);</span>
</span><span class='line'>    <span class="p">})</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you can imagine, this gets to be pretty ugly pretty quickly if you want even fairly simple sets of actions.  Futhermore, it&#8217;s difficult to store animation routines and run them more dynamically &#8211; users would have to implement their own methodology which would, at the most simple, look something like this&#8230;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">anims</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">left</span><span class="o">:</span>    <span class="p">{</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">100</span> <span class="p">}</span>
</span><span class='line'>  <span class="p">,</span> <span class="nx">down</span><span class="o">:</span>    <span class="p">{</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">100</span> <span class="p">}</span>
</span><span class='line'>  <span class="p">,</span> <span class="nx">turnRed</span><span class="o">:</span> <span class="p">{</span> <span class="nx">strokeColor</span><span class="o">:</span> <span class="s1">&#39;#f00&#39;</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="kd">function</span> <span class="nx">run</span><span class="p">(</span> <span class="nx">series</span> <span class="p">){</span>
</span><span class='line'>    <span class="nx">box</span><span class="p">.</span><span class="nx">animate</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span> <span class="nx">box</span><span class="p">,</span> <span class="nx">anims</span><span class="p">[</span><span class="nx">series</span><span class="p">.</span><span class="nx">shift</span><span class="p">()],</span> <span class="kd">function</span><span class="p">(){</span> <span class="nx">run</span><span class="p">(</span> <span class="nx">series</span> <span class="p">)</span> <span class="p">}</span> <span class="p">)</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'><span class="nx">runSeries</span><span class="p">([</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;down&#39;</span><span class="p">,</span> <span class="s1">&#39;turnRed&#39;</span> <span class="p">]);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Gross &#8211; we figured we could definitely do better than that.</p>

<h2>Enter Compositions</h2>

<p>First we thought it would be good if you could compose a series of animations like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// move left, then down, then fade the color</span>
</span><span class='line'><span class="nx">box</span><span class="p">.</span><span class="nx">animate</span><span class="p">([{</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">100</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">100</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">strokeColor</span><span class="o">:</span> <span class="s1">&#39;#f00&#39;</span> <span class="p">}]);</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is already clearly better than the alternative, but then we decided we had to include support to create <em>parallel</em> animations as well, something that was not possible in any way shape or form before.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// move left and down simultaniously but with different end times</span>
</span><span class='line'><span class="nx">box</span><span class="p">.</span><span class="nx">animate</span><span class="p">([[{</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">100</span><span class="p">,</span> <span class="nx">duration</span><span class="o">:</span> <span class="mi">500</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">50</span><span class="p">,</span> <span class="nx">duration</span><span class="o">:</span> <span class="mi">1000</span> <span class="p">}]]);</span>
</span></code></pre></td></tr></table></div></figure>


<p>By combining these you can compose a series of parallel animations:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">box</span><span class="p">.</span><span class="nx">animate</span><span class="p">([[{</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">100</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">100</span> <span class="p">}],[{</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">0</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">strokeColor</span><span class="o">:</span> <span class="s1">&#39;#f00&#39;</span> <span class="p">}]]);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Or parallel series:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">box</span><span class="p">.</span><span class="nx">animate</span><span class="p">([[[{</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">100</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">100</span> <span class="p">}],[{</span> <span class="nx">strokeColor</span><span class="o">:</span> <span class="s1">&#39;#f00&#39;</span><span class="p">},</span> <span class="p">{</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">0</span> <span class="p">}]]]);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Or any combination thereof:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">box</span><span class="p">.</span><span class="nx">animate</span><span class="p">([{</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">100</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">100</span> <span class="p">},</span> <span class="p">[{</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">0</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">strokeColor</span><span class="o">:</span> <span class="s1">&#39;#f00&#39;</span> <span class="p">},</span> <span class="p">[{</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">0</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">strokeColor</span><span class="o">:</span> <span class="s1">&#39;#0f0&#39;</span> <span class="p">}]]]);</span>
</span></code></pre></td></tr></table></div></figure>


<p>That&#8217;s it! You can <a href="https://github.com/danielmendel/glitz.js">fork glitz.js</a> and try them out for yourself.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Cool stuff I learned doing code review]]></title>
    <link href="http://danielmendel.github.com/blog/2013/02/20/cool-stuff-i-learned-doing-code-review/"/>
    <updated>2013-02-20T16:27:00-05:00</updated>
    <id>http://danielmendel.github.com/blog/2013/02/20/cool-stuff-i-learned-doing-code-review</id>
    <content type="html"><![CDATA[<p>So a major staple of <a href="http://www.hackerschool.com">Hacker School</a> is doing ( and getting ) lots and lots of code reviews.  I think this is <em>awesome</em>, and I&#8217;ve been working on a lot of reviewing this week.  The most rewarding thing about reviewing a language you are comfortable in is that you learn all kinds of things you might never come across when left to your own ingrained design patterns.  This is a short round up of some neat things I learned about <code>javascript</code> this week.</p>

<!-- more -->


<h2>Not just syntax!</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">foo</span><span class="p">(){</span> <span class="k">return</span> <span class="kc">true</span> <span class="p">};</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">bar</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span> <span class="k">return</span> <span class="kc">true</span> <span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>I had always assumed that the only difference between these styles of defining a function was syntactic &#8211; however, that&#8217;s not true! There is actually a crucial difference at runtime.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">foo</span><span class="p">();</span>  <span class="c1">// true</span>
</span><span class='line'><span class="nx">bar</span><span class="p">();</span>  <span class="c1">// ERROR! bar is not defined.</span>
</span><span class='line'><span class="kd">function</span> <span class="nx">foo</span><span class="p">(){</span> <span class="k">return</span> <span class="kc">true</span> <span class="p">};</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">bar</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span> <span class="k">return</span> <span class="kc">true</span> <span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is one of those things that now I know it, seems obvious.  The essential difference is that javascript loads all of the function definitions in a chunk of code before it begins execution.  When it encounters <code>foo()</code> it already has a reference to the function definition below.  However, <strong>the <code>bar</code> function is actually <em>anonymous</em> until the line assigning it to <code>bar</code> is executed</strong> &#8211; because this is <em>after</em> the line that tries to run <code>bar()</code> the call fails.</p>

<p>&#8211; with <a href="https://github.com/alliejones">Allie Jones</a></p>

<h2>Do While</h2>

<p>For some reason I have simply never really used javascript&#8217;s <code>do {} while ()</code> loop.  I use <code>while(){}</code> style loops all the time and somehow in the back of my mind must have foolishly assumed that they were all I&#8217;d ever need for a <code>while</code> ( pun! ).  I was wrong, there are cases where this syntax is super useful, consider this essential difference between the two.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="k">do</span><span class="p">{</span> <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span><span class="k">while</span><span class="p">(</span> <span class="kc">false</span> <span class="p">);</span>
</span><span class='line'><span class="k">while</span><span class="p">(</span> <span class="kc">false</span> <span class="p">){</span> <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="nx">a</span><span class="p">;</span> <span class="c1">// 1</span>
</span><span class='line'><span class="nx">b</span><span class="p">;</span> <span class="c1">// undefined</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong><code>do</code> always fires at least once.</strong>  This makes it perfect for things like collision prevention without having to init a variable separately.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// assume uniqueRandoms === { ... };</span>
</span><span class='line'><span class="k">do</span><span class="p">{</span> <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="p">}</span> <span class="k">while</span><span class="p">(</span> <span class="nx">uniqueRandoms</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>&#8211; with <a href="https://github.com/wija">Bill Abresch</a></p>

<h2>Applied Math</h2>

<p>Somehow I had never considered the pure simple genius of this strategy.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2</span> <span class="p">];</span>
</span><span class='line'><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span> <span class="nb">Math</span><span class="p">,</span> <span class="nx">arr</span> <span class="p">);</span>  <span class="c1">// 240</span>
</span></code></pre></td></tr></table></div></figure>


<p>&#8211; with <a href="https://github.com/greggreggreg7">Greg Altman</a> and <a href="https://github.com/patrickmestabrook">Patrick Estabrook</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Subclassing Javascript Arrays]]></title>
    <link href="http://danielmendel.github.com/blog/2013/02/20/subclassing-javascript-arrays/"/>
    <updated>2013-02-20T03:44:00-05:00</updated>
    <id>http://danielmendel.github.com/blog/2013/02/20/subclassing-javascript-arrays</id>
    <content type="html"><![CDATA[<p>When I started working on the animation framework <a href="https://github.com/danielmendel/glitz.js"><code>glitz.js</code></a>, I wanted an easy syntax for expressing and traversing a nested tree of <code>Renderable</code> objects.  I thought, &#8221;<em>Why not implement it as an array?</em>&#8221; Since the scene graph would need to be iterated over very quickly during the render loop, it would be great to just represent the whole thing as a multi-dimentional array &#8211; <strong>essentially a subclass of array</strong> that had some additional properties and methods like <code>render</code> and <code>animate</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">box1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Box</span><span class="p">({</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">100</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">100</span> <span class="p">});</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">box2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Box</span><span class="p">({</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">110</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">110</span> <span class="p">});</span>
</span><span class='line'><span class="nx">box1</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">box2</span> <span class="p">);</span>
</span><span class='line'><span class="nx">box1</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>       <span class="c1">// box2</span>
</span><span class='line'><span class="nx">box1</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span> <span class="c1">// draws a box</span>
</span></code></pre></td></tr></table></div></figure>


<!-- more -->


<h2><a id="naive"></a> 1. Ah, Naïveté</h2>

<p>First I tried a simple approach.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">arrLike</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">length</span><span class="o">:</span> <span class="mi">0</span> <span class="p">};</span>
</span><span class='line'><span class="nx">arrLike</span><span class="p">.</span><span class="nx">push</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">push</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span> <span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span> <span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nx">arrLike</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nx">arrLike</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>   <span class="c1">// &#39;foo&#39;</span>
</span><span class='line'><span class="nx">arrLike</span><span class="p">.</span><span class="nx">length</span> <span class="c1">// 1</span>
</span></code></pre></td></tr></table></div></figure>


<p>Basically, you can invoke methods from the native <code>Array.prototype</code> on any object with a length and get array-like results.  This works because <strong>javascript objects allow numerical keys</strong>, so essentially what we end up with is:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">arrLike</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="mi">0</span><span class="o">:</span> <span class="s1">&#39;foo&#39;</span>
</span><span class='line'>  <span class="p">,</span> <span class="nx">length</span><span class="o">:</span> <span class="mi">1</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>At first glance (eg, not in <code>IE&lt;8</code>), this seems to work great. However, <strong>there are hidden dragons</strong> &#8211; let&#8217;s compare some further manipulations to a native array.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">arr</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nx">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>         <span class="c1">// &#39;foo&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span>     <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="nx">arrLike</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="nx">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>         <span class="c1">// undefined</span>
</span><span class='line'><span class="nx">arrLike</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>      <span class="c1">// &#39;foo&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">arr</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>     <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nx">arrLike</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>     <span class="c1">// 11</span>
</span><span class='line'><span class="nx">arrLike</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="c1">// 0</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Uh-oh</strong>, there are obviously some drawbacks here.  First, <strong>setting the length property of a proper <code>Array</code> to <code>0</code>  clears the array</strong>.  In fact, this is usually the <a href="http://jsperf.com/clearing-arrays-without-reassigning-them">fastest method of clearing arrays</a>.  Second, when you assign a value to an array index that is <code>&gt; length</code>, then the native array will expand to contain it.  In short, <strong>native arrays have a magical <code>length</code></strong> that we miss out on entirely with the naive approach.  As usual, more information can be found in the <a href="http://bclary.com/2004/11/07/#a-15.4">relevant section of the EMCAscript spec</a>.</p>

<h2><a id="extension"></a>2. Direct extension</h2>

<p>Okay, so my naive approach is dead in the water &#8211; after grieving, I decided to try direct extension.  This is exactly what it sounds like: creating <code>Array</code> instances and copying a bunch of methods &amp; properties on to them directly.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">extension</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">x</span><span class="o">:</span> <span class="mi">0</span>
</span><span class='line'>  <span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">0</span>
</span><span class='line'>  <span class="p">,</span> <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span> <span class="p">...</span> <span class="p">}</span>
</span><span class='line'>  <span class="c1">// ...</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">Box</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">instanceProps</span> <span class="p">){</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">k</span><span class="p">;</span>
</span><span class='line'>  <span class="k">for</span><span class="p">(</span> <span class="nx">k</span> <span class="k">in</span> <span class="nx">extension</span> <span class="p">){</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span> <span class="nx">extension</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="p">)</span>
</span><span class='line'>          <span class="nx">arr</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">extension</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">for</span><span class="p">(</span> <span class="nx">k</span> <span class="k">in</span> <span class="nx">instanceProps</span> <span class="p">){</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span> <span class="nx">instanceProps</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="p">)</span>
</span><span class='line'>          <span class="nx">arr</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">instanceProps</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">arr</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>The outcome here is exactly what we want &#8211; a native array with some extra methods and properties.  There&#8217;s just one problem, <strong>compared to creating raw instances of a native array, it is <em>really, really slow</em></strong> &#8211; for example, in Firefox 17.0, <a href="http://jsperf.com/subclassing-arrays-direct-extension-variations/3">it is 26 x slower</a> when adding just two properties.</p>

<p>Now obviously there are a lot of use cases where this performance hit isn&#8217;t particularly painful &#8211; even at 1/26th speed you can still create many thousands of arrays per second, and probably most uses for <a href="https://github.com/danielmendel/glitz.js"><code>glitz.js</code></a> wouldn&#8217;t suffer too badly here.  But, <strong>this is in an animation framework</strong> and if we can speed any part of it up by that much, it increases the domain it can operate in by a fair margin.  This brings us to&#8230;</p>

<h2><a id="subclassing"></a>3. Having your cake and eating it inside of an iframe</h2>

<p>Wouldn&#8217;t it be the best if we could just subclass <code>Array</code> and add some methods to the <code>prototype</code>?  Of course this would contravine several of the golden rules of javascript best practices, first and foremost being <a href="http://www.nczonline.net/blog/2010/03/02/maintainable-javascript-dont-modify-objects-you-down-own/">don&#8217;t modify objects you don&#8217;t own</a>.  Another issue with this is that each user-defined <code>Renderable</code> subclass requires a different set of extentions to the <code>prototype</code> and <a href="http://perfectionkills.com/how-ecmascript-5-still-does-not-allow-to-subclass-an-array/#andrea_giammarchi_solution">trying to use prototypical inheritance</a> runs into the same issues as the <a href="#naive">naive solution</a>.</p>

<p>Enter Dean Edwards <a href="http://dean.edwards.name/weblog/2006/11/hooray/">iframe sandbox solution</a> &#8211; the idea here is that you create a hidden <code>&lt;iframe&gt;</code> and steal the <code>Array</code> object from the <code>iframe</code> execution context.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">iframe</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;iframe&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">iframe</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">iframe</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">frames</span><span class="p">[</span><span class="nx">frames</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span>
</span><span class='line'>      <span class="s2">&quot;&lt;script&gt;parent.myArray = Array;&lt;/script&gt;&quot;</span>
</span><span class='line'>    <span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nx">myArray</span> <span class="o">===</span> <span class="nb">Array</span> <span class="c1">// false</span>
</span><span class='line'><span class="nx">myArray</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">foo</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">arr</span>   <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">myarr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">myArray</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nx">myarr</span><span class="p">.</span><span class="nx">foo</span><span class="p">;</span>        <span class="c1">// &#39;bar&#39;</span>
</span><span class='line'><span class="nx">arr</span><span class="p">.</span><span class="nx">foo</span><span class="p">;</span>          <span class="c1">// undefined</span>
</span></code></pre></td></tr></table></div></figure>


<p>This works because browsers sandbox the javascript execution environments so that each frame owns a unique set of native objects.  Here we simply &#8220;borrow&#8221; ( read: steal ) one from a new iframe and send it back to our execution environment.  As you might imagine, this technique comes with some caveats:</p>

<ul>
<li>Keep that iframe around and attached to the DOM &#8211; it still technically owns our array.</li>
<li>This approach doesn&#8217;t work in non-browser environments.</li>
</ul>


<p>Number 2 is not a problem this purpose as <a href="https://github.com/danielmendel/glitz.js"><code>glitz.js</code></a> is already tied to the browser in other ways.  Additionally, if it were ever to be ported to a server context this same methodology could be recreated with a slightly different technique, such as borrowing <code>Array</code> from a <code>VM</code> in <code>node.js</code>.</p>

<p>Ultimately this is the technique I used for a major update to the way that <a href="https://github.com/danielmendel/glitz.js"><code>glitz.js</code></a> handles array subclassing under the hood in commit <a href="https://github.com/danielmendel/glitz.js/commit/5c5d183c7cbcdd26d669b40270745c5fddb9b539#L3R656"><code>5c5d183</code></a> and also ended up putting together <a href="https://github.com/danielmendel/gimme"><code>gimme</code></a> a tiny stand alone library to automate the process of &#8220;borrowing&#8221; natives.</p>

<p>For the most comprehensive overview of the techniques for subclassing arrays in javascript, read <a href="http://perfectionkills.com/how-ecmascript-5-still-does-not-allow-to-subclass-an-array">How ECMAscript 5 still does not allow to subclass an array</a> [sic].</p>
]]></content>
  </entry>
  
</feed>
